# Configuración de Cron Jobs para ToothPick
# Auto-invoicing para facturación automática de suscripciones

# Ejecutar facturación automática el día 1 de cada mes a las 6:00 AM
# 0 6 1 * * = minuto 0, hora 6, día 1, cualquier mes, cualquier día de la semana
0 6 1 * * curl -X POST -H "Authorization: Bearer ${AUTO_INVOICING_TOKEN}" ${NEXTAUTH_URL}/api/invoice/auto-process

# Ejecutar verificación diaria de suscripciones pendientes a las 9:00 AM
# 0 9 * * * = minuto 0, hora 9, cualquier día, cualquier mes, cualquier día de la semana
0 9 * * * curl -X POST -H "Authorization: Bearer ${AUTO_INVOICING_TOKEN}" ${NEXTAUTH_URL}/api/invoice/auto-process

# Respaldo semanal de estadísticas de facturación (Domingos a las 2:00 AM)
# 0 2 * * 0 = minuto 0, hora 2, cualquier día, cualquier mes, domingo (0)
0 2 * * 0 curl -X GET -H "Authorization: Bearer ${AUTO_INVOICING_TOKEN}" ${NEXTAUTH_URL}/api/invoice/auto-process/stats > /var/log/toothpick-invoicing-stats-$(date +\%Y-\%m-\%d).json

# Limpieza mensual de facturas canceladas antiguas (día 15 a las 3:00 AM)
# 0 3 15 * * = minuto 0, hora 3, día 15, cualquier mes, cualquier día de la semana
0 3 15 * * curl -X DELETE -H "Authorization: Bearer ${AUTO_INVOICING_TOKEN}" ${NEXTAUTH_URL}/api/invoice/cleanup

# Sincronización con Facturama para verificar estados (cada 6 horas)
# 0 */6 * * * = minuto 0, cada 6 horas
0 */6 * * * curl -X POST -H "Authorization: Bearer ${AUTO_INVOICING_TOKEN}" ${NEXTAUTH_URL}/api/invoice/sync

# Variables de entorno requeridas:
# AUTO_INVOICING_TOKEN=tu_token_secreto_aqui
# NEXTAUTH_URL=https://tu-dominio.com

# Configuración para PM2 (opcional):
# pm2 start ecosystem.config.js --cron-restart="0 6 1 * *"

# Para desarrollo local usando node-cron en lugar de system cron:
# Ver: lib/services/CronService.ts
